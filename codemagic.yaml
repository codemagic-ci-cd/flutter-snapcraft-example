workflows:
  snapcraft-release:
    name: Snapcraft Release
    instance_type: linux
    triggering:
      tag_patterns:
         - pattern: '*-test'
           include: true
    environment:
      flutter: master
      vars:
        SNAPCRAFT_LOGIN_CREDENTIALS: Encrypted(Z0FBQUFBQmdjX3dDcmd5MGhxa19FVjM0RUhRc0xDWjRNQzRnd3hVVW5nZVphRFpWSXdtWVQ2QVdkVFhVVEhEXzFJSXRiclEwMTMzWTQ5VFFqSmhjUEY0X1Q2TzNFV2ZQOGJTTHI5U0V6cE1BQWdsM2xucGw3Z1RQeS1HNHJ6Sk54SXc2NG8tR0VRTTFpRlN5eHpWUW42Q3FTV0xKRThpeU83emwwVE14LWI1VGtjd0dZUDBnbzJ4eGcybVZqdlB0NndHVEJ2ZlpBamc3UmptWjJ5NlBqVy1peVNoVm9vck9Zd3c3YnFucXhHUVNpQkZvRUFybm1XV0F5M0NFMUtaNm5FS0tiSXVuclVfaERVTks2Nmh2cG91MXY2STk2ZFpjVk15LUJXYjZGeExnV2dQbDI5MXdQT04yZk9TLW5SR2N2cmx5RzE5Tm9Md1ZIZW5FV3YtUndKaFNqNEhxSG02SE51RG5DSVNEM3lpNzYwTzY2ZW5CSENVdi1USTlQTGZJRWozeW1YNlo0YXhYekxFVi1HVUU5dUlZVkVTRjg1cUNDSFpTZHJ0RkJrZEtwb1l3RVlraU1hVTFUWG9HLWxwQmhvX2pRcVJnRHZpNG93U2dvZ0pIa3M4TzQtTDh3Y2Fza1dNSjBUeWI1ODJ6OFVJeTJqU1RLbVdUY2FQRGxXdEJXZnBQTzZXMTVzdy1EV0x3Ul84dHR6WTByTlNZSV8xRkN0a1J5Uzd6cEtVclFfNlRhZ3hPQ0owS1kxZVhadGlLNndIZUdWUEQ5MkxKWGItSFlrc0hCT04xcXJ2am9IV2loVlRzeG5WRFlZNmtIYkdETE5ZV1FGdHQwQnpuVUgtcFpGTTBTZlhENEN1QzRtZ0FFZ2UwZEphQ2NpSEROUWRWS1MtV3pPYnZOSlRLZlNWRU9LNFZnQnNlV0hwYXhVcTRjN21JQTVlcDY5bTF2RzczanZIeDAzQ2ZaSUJJN1ZJaUVYWWNnelVGdzd1QUhWSWtNMFBUcGhMTS0zcWgwbU9LMkJGYmE3SUN5N00xREVzaHgxU1p5dzdpRzFpTEtrMHlYRldiMElxY1BybzZKakJyRm5oQWlNZmZMN0ZFRkU5QmtPU3VJaW1BWkxTNVVYbDZhclJRdVVsbEVIcU1ic3dVczhsaG5uTFNXQVU2bERWQ1NLWU13X25ZMWxlNHFGdFZJNkZmN09HMG40Ujc3dzlUcWVsVHpzUi1oNWdFS1ZieUUxZE1ZZXRQU2gybk93dC1DVURCcHR4N3pvVm10dHljbFFweHZqOU45MHZoUHE2X2oyLVA2U1BUUUswNnRCcS1wTGg0WGNVZ0NJb3RXdmlVNFVPZkRNSkpTZ3dVamZ5NXNRbkc1MEt0WktCeGZnVzVnMnBwREhmUENFTkxQNFN4Y3VnWmgxYjJSMG56aGRpZ0pkbFBPSEFMTDRNTVdiTWFJb2VDYXVqNVNqWDZmc0g3Z1dEZVlsQUFQT1NqWVZ2LWdUYUk4MF9FSzBXNGRFSml1WXVncWVleGVOcFZFMkFoSnVuM0k2eDVmd1JFWEtJMXdVS0JvbFY4VzRHVms5c0Job1laYmhSWmFoQ3NGZnRDOVhGQ3BLTzZ2WVdpZldYSU1wSVZQV203ckgtallmNXlsUXkwbzllOFpCVWc4T2lPamVxNlNfSDEwQWY4anJTSU9XU3FpakR2UWFXSmxsWmVWaEZLSmM2V1k3TldRNmJ0WS1DNFh5SkZhUUUzVXl2c3N4YkU4UmY4bGJzdkxLTjNvOHdzQlpjY0xpQk90V1EzcTNTcmYwcGl4RkRsd0FqTnlYYmFuNkRqX3o5RmlHUm5KMldEaWg4REZ1NmpROHJGOUwxaGgwOTVqbzZPYURRQ2xwbWdVVzFwckZTR2F1RUs2SUJoamhIODBaanRnOEgwRHRObzNQSHA0dEN0azIxdDBHUHFzRnBfVWlydEk2VElXZW5rUXhQTUlnTWcwQTRaVXU2LVBqVzVhT3FKNUJZQ19lbS1fRW85RGNZa2FKVHZpV21uMDJ0WkJ1aVI3NXBQelpsWjM1M1lMbG9CTjN1MVVRMHdTM2xPQVhTcjdhejczUFc1XzdCZFFhZkUxeHJfb29zbXh5dzFFbEx5Y2F2ZG5OVE5Yc19yWjRHVk56SGdieDlCZWNqSDh2LWZTUGxXV09HUGVoakMtekUtejFTYnZZZlMtekp2UE5CZ0N4WkwwV3NjTDVrV19kYkRkMVVnall1SElBSHE0QW5rakliVlNLdVJqOTRDSkgxNXdzZWNZYnhPeHN4Zmp4NGJCVXNac2hETTdGZEdwTk5VVjdxRHBsbFBVNXRTT0xDWjNmLWhTQldjeUotVUNXZXVqTkhWVk5CV1RIRmFKS1BZNzZXZ21BRDVpaFUtelp0M0lYeXhabXVrblV4Z2Q3c20wVFNhQXh1TmZ4NmxmVzhFb1p1aFZrYVMtZ3J6OC02b282OGxGdEM3SGptSlJGQVZ6NXZKMm9oTTBzUlNYUUs3d0Z5dUxYX3lRZGd5WXNHNk1hT0RBOHA3bXRTbjNIQjVIYWNkUGJHU2FJOHAwWnlvRzdMVFAxS0tJNEdLdEtOLXl3YUlJdjYwV0tvNjdfQ05tZjkyRThlNTVQWXB4cjB5cC16ZTU1NXE4RktBYXVEcVBJa3ZBT0RmZ01LSk11MFJtZGZaSXFBZUNEbXlQdkU1aWV1OGo1NFU0cXp0cWpMTV9SZXdIQ3BGUEY4TlM5NWxWMUQ5YUNiakhyNWRqVmZ3UVh1TEhrUUFkQk11VGlsWG9LQm1fdHplM0hFMHBnRXM1bU9HZ3BFbHdJMVJSb2VlT1VxVUd0SG83aHoxUHNyQ2w0VUQxVEdHY0hubVZsUk54MWN1cFRDcnM3VFJnQkJIc1FRbHNDVGpxWHYyZ0l1SVBUeG9Tc1NIV2w4Q2RxeE1aVGJBNUd4ekJwM3d5VTEzYmtXa0hCdWR5cDIyd0tqOGVCT0V5S2d4elJLeEZEa1BqN2tja0wzaVBmWmozR2cyMkdnd0EtXy13aXI2cDBJZVpQZ0t2a0NYNm16UHVEZVJGM2thSzRyYkg2Ml9PdW42NzlleDRTU0NjR2wxQnE4cUZ3ZlFMMHpZSDB6V2xlZjNpNU41Q0VYMEVZNDNST3pLTUNWcExlYWVnRWtqMWNLRnRWcVQwZ05ZRTg0ek5PZEwtMm1EMlhDbFlYSDFlSHpnTmNRLXhxUTAxT1ZvVDNldUxUVEJkOE4xWXpzc3p5d1luRTY3c0FMSDlKSm03ajluakYzc0NhOVFTYUVGNVNSWDRQZS1tbVktdzFaTDR3UEFfZkQtX0lCYmQ4MkFhOGppaVI4ZVJOUHNIZzh6S1BTN09yd1lOOXlXUkFZOFRIVERfdkZrUmlUOWNEX3d4MDExTERNYnRtRTNhazZQN1ZnNWNudkQxOHdpR3JPSm1hSFVLRE5NUjVNcUhfQWhQYmxKd0JUN1Y4YkFnR1AtbS0xNGY1aFB4Y0tmQklXN3l2YldqaUdsTm9xbUtoTnJUQ29Vd0ZHdm5reVZJUmNrRkpJY1VrR0liUFM0UzFsTlc1amx0VUU0dm8wdjM3Q1hLaGxSMUdiNlZndlZQVnE5TWhYdWpFUmdRTURQOW9LbExoUGY0YTgwbTNBYUtvb1VjOUQ4OXlLVGgzd1RYLURmTVJleXFod0RkOVYzdHZSR3pwNUdCcVp5azhDZzV1RzRVeVlGemhrSmE3djVjbDZlcmpEajQyZkxUZUQxODVjamNoOEMtUDZBeWR1T1d6MF9PMUtXcHBidnIzd21JY3pxSUhhVGN0VGFScExZVHl4SUx6WUdVdEhNR0x2a09KWDVqdl9udHhYblAxME5rZDZxalZlUk9zN05hc21LendBdkl2YUVOSlVvWGtHY1N5Q09VZGdpUVJZMWhPaHNweTBPWmRCeWpaeXNsVm1WLU92NWZGMkV5SzYwR1hzdk5Yb0E3Q2lkdzh3R3NCWTVYTnY3WmJTRUV0TFFNM1VkMUVJVWxabDBLZlRidm84M1I0czFHTEwwUHVWQ0VJb2JTU2RyeU15V21TNVh4REZlYjVrQ1ZHWTRoVHFVR0UwVGF6WGg4TDhuV29VOVVNM3VseloteFJRN2lFMHFxNEF2N3REcFhraHg3ZFpFcGpUOFRfemVXa3QxNG5mZUFfTkhfZkh4WWF4eUlRekQyenNHbjVuSjlQWlM4MWZiLXJqYUQ1SjJ0aXo3bHpUcUpSeElnREVCWGFaZHhlbE8yRFAyRG5TWW5LTnFhSGFVNWVPblVMb3E0UzBRcDk3Z2VxQXJoWElBZG9ydjB4TXRNai1yemFGSUNlVm1paVpXVkZLYkFscUJqbjlmTFdYSm9vSXlOMjVOT0I3QTdUeVc3X21iUVNZWWdZRUFOY1BYdVQwcjBUVFN3X3lyTU1xZWhnWFBHQlp3OENObWJQRXVkUWxPTlRjZm1WSnVGZUgwYlUyMGV2cGhVMjZYNlZMbWtNSDBFcDhkakEyZnpVWktmV05tc1N6b0hrWTh0Z1IxdDBaeW9KSGlIUDBBYk9YczllV1ZNRS1mcEI4SU9Vd3pwYy1mNVh1RTVpeUhSV0lUYV9HSU80VldSZmJDVmZrR2F2aEg5cHNuNXlZMzgyeE5adVNKRldaS0RVX0lOTW91NTVZM0NBZlNHa2o1MVRROXFuTi14RWFsVVdiOEtYRUlQMTB5WWZ3cnJ4TFZfQmVWd2hnTzhWbjdQRDVpd3hiTjJ1aXg4OWU0VEdHR2M5c2dhWmc0cnVQQUJ2SmdlOFpaWV9aQVlzSjlkWEVOT2NmcDR1Z2JuTjhLVl8wSDNmNUwyaDVKWFY3MlpGLWQxdlFLUktmckxQSXlxempONFM0YWMzdm1MMWtib1FyOXNzRjNmOHpPZ2lxRnlsQ2E5TUlpenNoYlh5TVoxY1VkdFlQbzREcW51RkI0WjdwM3J2NHdaaUVCS1RfNjRPTlhlS0pIbFppbkFLNC1SVHE3eFpOeGhDV0lFYW1sY1JCMmN1XzRYRy0yQTBVQXVSS2Y1MzMzaFpxMG9hdmgxbGkwbVB2ZmhkTjlHbG9QNi01aGdKdkFJcjhVQTdDMUNmLURTczhXTG90cTZJRTdrZ3JaNENWcS10NWtiLVlGZmcyWVJ1RTd4YmJSOG5fUnk0RkhjbEwyTldSQ2F1X3BIQURNcXI5Q1BjY0ZRUlFEMzNRNERzNDdudEdseTRORnl3cnJSMVNjeEkzLUpSSmY0MVhzV19MMEpNR0NqUUgxX0dGOGVfcENVY045cThOWTVvWTJtUkVnVjJKc2ZHUGlfWUhycEdlLTFTYTRPV1pfanloVG11NXVfeVhXb3dXRG9XOXpPR1ZFby1vaFRjaV8tRmxFSGtra3lHT2dpOGJKalZuYWxMSmR4TEx2RWRLNEx0OHd5NThSbFBzcWtyQndTMzRUUjlENWtDVTlEV0F5bnF4c2tuZ1FsZFhCaS04WktzXzQ4S2NEdHdEd0RhbUZnY19kbG1Zb1lrVlQ4Wm1raTFaU3hYaGp2Y093dWpwSzdGSnVoSTdhSkZJRWtqb3ZwZmRGZEpHMmkxSDhhaHZ3bTd2OUs4WDRjbWRlWHcxZzAwOFdhMDZtUE5IOUJBbHdKM1ZKLXRrWUZhLTRWZjU3dmpzMmRobl9nTVk0bkgtNEhKekkzLUlfU1RneWlQV0prYV91WHRVQ2I3VjV4dDh6SFExckRzUUNSZVl5UFpVN1BqRk1UOTFicWdvdXc0YUdzXzZNN3UzVmhOQ0I4SVhZSlRkUjVXZE04UF80Y2cwT3hfNm4=)
        SNAPCRAFT_BUILD_ENVIRONMENT: host
    scripts:
      - name: Authenticate
        script: |
          echo $SNAPCRAFT_LOGIN_CREDENTIALS | base64 --decode > /home/builder/snapcraft-login-credentials
          snapcraft login --with /home/builder/snapcraft-login-credentials
      - name: Create a snap
        script: snapcraft snap --output flutter-codemagic-example.snap
      - name: Upload and release
        script: snapcraft upload flutter-codemagic-example.snap --release stable
